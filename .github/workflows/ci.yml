name: CI

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository and submodules
      uses: actions/checkout@v2

    - name: install Eigen3
      run: |
        git clone https://github.com/eigenteam/eigen-git-mirror.git
        cd eigen-git-mirror
        git checkout 3.3.7
        mkdir build && cd build
        cmake ..
        sudo make install

    - name: install pybind11
      run: |
        git clone https://github.com/pybind/pybind11.git
        cd pybind11
        git checkout v2.6.0
        mkdir build && cd build
        cmake -DPYBIND11_TEST=OFF ..
        make -j2
        sudo make install

    - name: install OpenCV
      run: |
        git clone https://github.com/opencv/opencv.git
        cd opencv
        git checkout 4.5.0
        mkdir build && cd build
        cmake -DWITH_VTK=OFF -DWITH_GTK=OFF -DWITH_PROTOBUF=OFF -DBUILD_PERF_TESTS=OFF -DBUILD_TESTS=OFF -DWITH_WEBP=OFF ..
        make -j2
        sudo make install

    - name: configure & make
      run: |
        mkdir build && cd build
        cmake ..
        make -j2
